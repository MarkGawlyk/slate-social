---
const features = [
  { 
    title: "Mobile App", 
    desc: "Members can manage subscriptions, book sessions, and access passes.", 
    icon: "ðŸ“±", 
    link: "/features/mobile-app",
    details: "Your gym in their pocket. Features digital membership cards for QR entry, instant class booking, and full subscription control without front-desk help. Keeps members engaged with push notifications and easy access."
  },
  { 
    title: "Website", 
    desc: "Web-based portal for complete account management and gym interaction.", 
    icon: "ðŸ’»", 
    link: "/features/website",
    details: "A fully integrated digital front door. Handle waivers online, display live occupancy, and let members manage their accounts from any browser. Seamlessly syncs with your facility operations."
  },
  { 
    title: "Access Control", 
    desc: "Smart pass management and seamless check-in systems.", 
    icon: "ðŸŽ«", 
    link: "/features/access-control",
    details: "Automate entry with turnstile integration and 24/7 access control capabilities. Real-time logging ensures you always know who is in the gym, simplifying safety and check-in flow."
  },
  { 
    title: "Backend Dashboard", 
    desc: "Powerful tools for staff to manage operations and track metrics.", 
    icon: "ðŸ“Š", 
    link: "/features/dashboard",
    details: "The command center for your business. Track revenue, monitor retention rates, manage staff schedules, and oversee route setting distribution all from one intuitive interface."
  },
  { 
    title: "SLATE Social", 
    desc: "A built in social network for your gym's community.", 
    icon: "ðŸ’¬", 
    link: "/features/slate-social",
    details: "More than just a newsletter. Connect members, host discussions, share beta, and build a thriving digital community alongside your physical one."
  },
  { 
    title: "In-Store PoS", 
    desc: "Seamless point of sale for retail, cafe, and entry management.", 
    icon: "ðŸ’³", 
    link: "/features/pos",
    details: "Unified inventory management for your pro shop and cafe. Scan items and check members in simultaneously. Fast, reliable, and fully integrated with member accounts."
  }
];
---
<section id="features" class="py-24 border-t border-zinc-200 dark:border-zinc-800 fade-in">
  <div class="container px-4 md:px-6 max-w-5xl mx-auto">
    <div class="text-center mb-16">
      <h2 class="text-3xl font-bold tracking-tighter sm:text-4xl md:text-5xl">Platform Modules</h2>
      <p class="mt-4 text-zinc-500 dark:text-zinc-400">Comprehensive tools for modern climbing facilities.</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {features.map((feature, index) => (
        <button 
          data-index={index}
          class="feature-card group rounded-lg border border-zinc-200 bg-transparent p-6 hover:border-zinc-900 dark:border-zinc-800 dark:hover:border-zinc-50 transition-colors block text-left w-full cursor-pointer focus:outline-none focus:ring-2 focus:ring-zinc-500"
        >
          <div class="text-4xl mb-4 grayscale opacity-80 group-hover:opacity-100 transition-opacity">{feature.icon}</div>
          <h3 class="text-lg font-bold">{feature.title}</h3>
          <p class="mt-2 text-sm text-zinc-500 dark:text-zinc-400">{feature.desc}</p>
        </button>
      ))}
    </div>
  </div>
</section>

<!-- Modal (Outside Section to escape transform context) -->
<div id="feature-modal-backdrop" class="fixed inset-0 z-[100] bg-black/60 backdrop-blur-md opacity-0 pointer-events-none transition-opacity duration-300 flex items-center justify-center p-4" aria-hidden="true">
    <div id="feature-modal" class="bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl max-w-lg w-full p-8 shadow-2xl transform scale-95 opacity-0 transition-all duration-300 relative">
        <button id="modal-close" class="absolute top-4 right-4 text-zinc-400 hover:text-black dark:hover:text-white">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
        
        <div class="text-5xl mb-6 grayscale opacity-80" id="modal-icon"></div>
        <h3 class="text-2xl font-bold mb-4" id="modal-title"></h3>
        <p class="text-zinc-600 dark:text-zinc-300 leading-relaxed mb-8" id="modal-details"></p>
        
        <div class="flex justify-end">
            <a id="modal-learn-more" href="#" class="inline-flex items-center gap-2 bg-black dark:bg-white text-white dark:text-black px-6 py-2 rounded-lg font-medium hover:opacity-90 transition-opacity text-sm">
                Learn More
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
            </a>
        </div>
    </div>
</div>

<script define:vars={{ features }}>
    const cards = document.querySelectorAll('.feature-card');
    const backdrop = document.getElementById('feature-modal-backdrop');
    const modal = document.getElementById('feature-modal');
    const closeBtn = document.getElementById('modal-close');
    
    // Modal Elements
    const modalIcon = document.getElementById('modal-icon');
    const modalTitle = document.getElementById('modal-title');
    const modalDetails = document.getElementById('modal-details');
    const modalLink = document.getElementById('modal-learn-more'); // Type assertion for anchor

    let isOpen = false;

    function openModal(index) {
        const feature = features[index];
        if (!feature || !backdrop || !modal) return;

        // Populate Content
        if (modalIcon) modalIcon.textContent = feature.icon;
        if (modalTitle) modalTitle.textContent = feature.title;
        if (modalDetails) modalDetails.textContent = feature.details;
        if (modalLink) modalLink.setAttribute('href', feature.link);

        // Show Modal
        backdrop.classList.remove('opacity-0', 'pointer-events-none');
        modal.classList.remove('scale-95', 'opacity-0');
        isOpen = true;
        document.body.style.overflow = 'hidden'; // Prevent scrolling
    }

    function closeModal() {
        if (!backdrop || !modal) return;
        
        backdrop.classList.add('opacity-0', 'pointer-events-none');
        modal.classList.add('scale-95', 'opacity-0');
        isOpen = false;
        document.body.style.overflow = '';
    }

    // Event Listeners
    cards.forEach((card) => {
        card.addEventListener('click', () => {
             const index = parseInt(card.getAttribute('data-index') || "0");
             openModal(index);
        });
    });

    closeBtn?.addEventListener('click', closeModal);
    
    // Close on click outside
    backdrop?.addEventListener('click', (e) => {
        if (e.target === backdrop) {
            closeModal();
        }
    });

    // Close on Escape
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && isOpen) {
            closeModal();
        }
    });
</script>
