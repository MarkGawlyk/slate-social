---
---

<section id="register" class="py-24 relative overflow-hidden bg-zinc-50 dark:bg-zinc-950">
    <!-- Background Decor (Subtle matching the hero) -->
    <div class="absolute inset-0 z-0 opacity-30 pointer-events-none">
        <div class="absolute top-[20%] left-[-10%] w-[500px] h-[500px] rounded-full bg-purple-400/20 dark:bg-purple-900/20 blur-[100px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] rounded-full bg-cyan-400/20 dark:bg-cyan-900/20 blur-[100px]"></div>
    </div>

    <div class="container px-4 md:px-6 max-w-4xl mx-auto relative z-10">
        <div class="text-center space-y-4 mb-12">
            <h2 class="text-3xl md:text-5xl font-black tracking-tighter text-zinc-900 dark:text-white">
                Join the <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-cyan-600 dark:from-purple-400 dark:to-cyan-400">Beta</span>
            </h2>
            <p class="text-lg text-zinc-600 dark:text-zinc-400 max-w-2xl mx-auto">
                We're currently working with a select group of climbing gyms. Register your interest to get early access and updates.
            </p>
        </div>

        <div class="bg-white/50 dark:bg-zinc-900/50 backdrop-blur-xl border border-zinc-200 dark:border-zinc-800 rounded-2xl p-8 md:p-10 shadow-xl">
            <!-- 
                 FORM ACTION: 
                 Submits to Supabase via client-side JS
            -->
            <form id="register-form" class="space-y-6">
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label for="name" class="text-sm font-medium text-zinc-900 dark:text-zinc-100">Full Name</label>
                        <input 
                            type="text" 
                            name="name" 
                            id="name" 
                            required
                            class="w-full px-4 py-3 rounded-lg bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all"
                            placeholder="Alex Honnold"
                        />
                    </div>
                    <div class="space-y-2">
                        <label for="gym" class="text-sm font-medium text-zinc-900 dark:text-zinc-100">Gym Name</label>
                        <input 
                            type="text" 
                            name="gym" 
                            id="gym" 
                            required
                            class="w-full px-4 py-3 rounded-lg bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all"
                            placeholder="El Cap Gym"
                        />
                    </div>
                </div>

                <div class="space-y-2">
                    <label for="email" class="text-sm font-medium text-zinc-900 dark:text-zinc-100">Work Email</label>
                    <input 
                        type="email" 
                        name="email" 
                        id="email" 
                        required
                        class="w-full px-4 py-3 rounded-lg bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all"
                        placeholder="alex@elcapgym.com"
                    />
                </div>

                <div class="space-y-2">
                    <label for="message" class="text-sm font-medium text-zinc-900 dark:text-zinc-100">What are your biggest social challenges? (Optional)</label>
                    <textarea 
                        name="message" 
                        id="message" 
                        rows="4"
                        class="w-full px-4 py-3 rounded-lg bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all resize-none"
                        placeholder="We struggle with..."
                    ></textarea>
                </div>

                <div id="form-message" class="hidden rounded-lg p-4 text-sm font-medium"></div>

                <button 
                    type="submit"
                    id="submit-btn"
                    class="w-full py-4 px-6 bg-zinc-900 hover:bg-zinc-800 dark:bg-white dark:hover:bg-zinc-200 text-white dark:text-black font-bold text-lg rounded-lg transition-colors shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    Register Interest
                </button>
            </form>
        </div>
    </div>
</section>

<script>
    import { createClient } from '@supabase/supabase-js';

    // Initialize Supabase client
    const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
    const supabaseKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;

    let supabase;
    if (supabaseUrl && supabaseKey) {
        supabase = createClient(supabaseUrl, supabaseKey);
    }

    const form = document.getElementById('register-form') as HTMLFormElement;
    const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
    const messageEl = document.getElementById('form-message') as HTMLDivElement;

    if (form) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!supabase) {
                console.error('Supabase not configured');
                showMessage('Configuration error. Please contact us directly.', 'error');
                return;
            }

            // Loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            const formData = new FormData(form);
            const data = {
                full_name: formData.get('name'),
                gym_name: formData.get('gym'),
                email: formData.get('email'),
                message: formData.get('message'),
                source: 'landing_page'
            };

            try {
                const { error } = await supabase
                    .from('registrations')
                    .insert([data]);

                if (error) throw error;

                // Success
                form.reset();
                showMessage('Thanks for your interest! We will be in touch shortly.', 'success');
            } catch (error) {
                console.error('Error:', error);
                showMessage('Something went wrong. Please try again later.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Register Interest';
            }
        });
    }

    function showMessage(text: string, type: 'success' | 'error') {
        if (!messageEl) return;
        
        messageEl.textContent = text;
        messageEl.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'dark:bg-green-900/30', 'dark:text-green-400', 'dark:bg-red-900/30', 'dark:text-red-400');
        
        if (type === 'success') {
            messageEl.classList.add('bg-green-100', 'text-green-800', 'dark:bg-green-900/30', 'dark:text-green-400');
        } else {
            messageEl.classList.add('bg-red-100', 'text-red-800', 'dark:bg-red-900/30', 'dark:text-red-400');
        }
        
        messageEl.classList.remove('hidden');
    }
</script>
        </div>
    </div>
</section>
