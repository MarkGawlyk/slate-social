---
---

<section id="register" class="py-24 relative overflow-hidden bg-zinc-50 dark:bg-zinc-950 border-t border-zinc-200 dark:border-zinc-800">
    <!-- Modern grid background -->
    <div class="absolute inset-0 z-0 opacity-[0.03] dark:opacity-[0.02]">
        <div class="absolute inset-0" style="background-image: linear-gradient(to right, currentColor 1px, transparent 1px), linear-gradient(to bottom, currentColor 1px, transparent 1px); background-size: 60px 60px;"></div>
    </div>
    
    <!-- Background Decor (Subtle matching the hero) -->
    <div class="absolute inset-0 z-0 opacity-40 pointer-events-none">
        <div class="absolute top-[20%] left-[-10%] w-[500px] h-[500px] rounded-full bg-purple-400/20 dark:bg-purple-900/30 blur-[100px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] rounded-full bg-cyan-400/20 dark:bg-cyan-900/30 blur-[100px]"></div>
    </div>

    <div class="container px-4 md:px-6 max-w-4xl mx-auto relative z-10">
        <div class="text-center space-y-4 mb-12 fade-in">
            <p class="text-sm font-mono uppercase tracking-wider text-purple-600 dark:text-purple-400">Get Started</p>
            <h2 class="text-3xl md:text-5xl font-black tracking-tighter text-zinc-900 dark:text-white">
                Join the <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-cyan-600 dark:from-purple-400 dark:to-cyan-400">Beta</span>
            </h2>
            <p class="text-lg text-zinc-600 dark:text-zinc-400 max-w-2xl mx-auto">
                We're currently working with a select group of climbing gyms. Register your interest to get early access and updates.
            </p>
        </div>

        <div class="bg-white/80 dark:bg-zinc-900/80 backdrop-blur-xl border border-zinc-200 dark:border-zinc-800 rounded-2xl p-8 md:p-10 shadow-2xl shadow-purple-500/5 dark:shadow-purple-500/10 fade-in" style="animation-delay: 0.2s;">
            <!-- 
                 FORM ACTION: 
                 Submits to Supabase via client-side JS
            -->
            <form id="register-form" class="space-y-6">
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label for="name" class="text-sm font-medium text-zinc-900 dark:text-zinc-100">Full Name</label>
                        <input 
                            type="text" 
                            name="name" 
                            id="name" 
                            required
                            class="w-full px-4 py-3 rounded-xl bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all hover:border-purple-300 dark:hover:border-purple-600"
                            placeholder="Alex Honnold"
                        />
                    </div>
                    <div class="space-y-2">
                        <label for="gym" class="text-sm font-medium text-zinc-900 dark:text-zinc-100">Gym Name</label>
                        <input 
                            type="text" 
                            name="gym" 
                            id="gym" 
                            required
                            class="w-full px-4 py-3 rounded-xl bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all hover:border-purple-300 dark:hover:border-purple-600"
                            placeholder="El Cap Gym"
                        />
                    </div>
                </div>

                <div class="space-y-2">
                    <label for="email" class="text-sm font-medium text-zinc-900 dark:text-zinc-100">Work Email</label>
                    <input 
                        type="email" 
                        name="email" 
                        id="email" 
                        required
                        class="w-full px-4 py-3 rounded-xl bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all hover:border-purple-300 dark:hover:border-purple-600"
                        placeholder="alex@elcapgym.com"
                    />
                </div>

                <div class="space-y-2">
                    <label for="message" class="text-sm font-medium text-zinc-900 dark:text-zinc-100">What are your biggest social challenges? (Optional)</label>
                    <textarea 
                        name="message" 
                        id="message" 
                        rows="4"
                        class="w-full px-4 py-3 rounded-xl bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-zinc-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all resize-none hover:border-purple-300 dark:hover:border-purple-600"
                        placeholder="We struggle with..."
                    ></textarea>
                </div>

                <div id="form-message" class="hidden rounded-xl p-4 text-sm font-medium"></div>

                <button 
                    type="submit"
                    id="submit-btn"
                    class="group w-full py-4 px-6 bg-gradient-to-r from-purple-600 to-cyan-600 hover:from-purple-700 hover:to-cyan-700 text-white font-bold text-lg rounded-xl transition-all duration-300 shadow-lg shadow-purple-500/25 hover:shadow-xl hover:shadow-purple-500/30 transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                >
                    <span class="flex items-center justify-center gap-2">
                        Register Interest
                        <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                        </svg>
                    </span>
                </button>
            </form>
        </div>
    </div>
</section>

<script>
    import { createClient } from '@supabase/supabase-js';

    // Initialize Supabase client
    const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
    const supabaseKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;

    let supabase;
    if (supabaseUrl && supabaseKey) {
        supabase = createClient(supabaseUrl, supabaseKey);
    }

    const form = document.getElementById('register-form') as HTMLFormElement;
    const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
    const messageEl = document.getElementById('form-message') as HTMLDivElement;

    if (form) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!supabase) {
                console.error('Supabase not configured');
                showMessage('Configuration error. Please contact us directly.', 'error');
                return;
            }

            // Loading state
            submitBtn.disabled = true;
            const originalContent = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span class="flex items-center justify-center gap-2"><svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Submitting...</span>';
            
            const formData = new FormData(form);
            const data = {
                full_name: formData.get('name'),
                gym_name: formData.get('gym'),
                email: formData.get('email'),
                message: formData.get('message'),
                source: 'landing_page'
            };

            try {
                const { error } = await supabase
                    .from('registrations')
                    .insert([data]);

                if (error) throw error;

                // Success
                form.reset();
                showMessage('Thanks for your interest! We will be in touch shortly.', 'success');
            } catch (error) {
                console.error('Error:', error);
                showMessage('Something went wrong. Please try again later.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalContent;
            }
        });
    }

    function showMessage(text: string, type: 'success' | 'error') {
        if (!messageEl) return;
        
        messageEl.textContent = text;
        messageEl.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'dark:bg-green-900/30', 'dark:text-green-400', 'dark:bg-red-900/30', 'dark:text-red-400');
        
        if (type === 'success') {
            messageEl.classList.add('bg-green-100', 'text-green-800', 'dark:bg-green-900/30', 'dark:text-green-400');
        } else {
            messageEl.classList.add('bg-red-100', 'text-red-800', 'dark:bg-red-900/30', 'dark:text-red-400');
        }
        
        messageEl.classList.remove('hidden');
    }
</script>
