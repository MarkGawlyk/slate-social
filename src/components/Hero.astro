---
import { ArrowDown } from 'lucide-astro';
---

<section class="min-h-screen flex flex-col justify-center items-center relative overflow-hidden bg-zinc-100 dark:bg-zinc-950">
  
  <!-- Liquid Background (Deepest Layer) -->
  <div class="absolute inset-0 z-0">
    <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-purple-400/30 dark:bg-purple-900/40 blur-[80px] md:blur-[120px] animate-blob mix-blend-multiply dark:mix-blend-lighten"></div>
    <div class="absolute top-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-cyan-400/30 dark:bg-cyan-900/40 blur-[80px] md:blur-[120px] animate-blob animation-delay-2000 mix-blend-multiply dark:mix-blend-lighten"></div>
    <div class="absolute bottom-[-10%] left-[20%] w-[40%] h-[40%] rounded-full bg-pink-400/30 dark:bg-pink-900/40 blur-[80px] md:blur-[120px] animate-blob animation-delay-4000 mix-blend-multiply dark:mix-blend-lighten"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-green-300/30 dark:bg-green-800/40 blur-[80px] md:blur-[120px] animate-blob animation-delay-6000 mix-blend-multiply dark:mix-blend-lighten"></div>
  </div>

  <!-- Fluid Dot Grid (Canvas) -->
  <canvas id="dot-canvas" class="absolute inset-0 z-0 pointer-events-none opacity-60 mix-blend-normal dark:mix-blend-screen"></canvas>

  <!-- Content (Top Layer) -->
  <div class="container px-4 md:px-6 max-w-6xl mx-auto text-center space-y-12 z-10 relative pointer-events-none">
    
    <div class="space-y-6 pointer-events-auto">
        <p class="text-xs md:text-sm font-mono uppercase tracking-[0.3em] text-zinc-500 dark:text-zinc-400">
            Social Media for Climbing Gyms
        </p>
        
        <h1 class="text-4xl sm:text-5xl md:text-7xl lg:text-8xl font-black tracking-tighter leading-snug md:leading-[1.1] selection:bg-zinc-900 selection:text-white dark:selection:bg-white dark:selection:text-black">
            The <span class="relative inline-block px-2 md:px-4 before:content-[''] before:absolute before:-inset-0.5 md:before:-inset-1 before:-skew-x-6 before:bg-black before:text-white dark:before:bg-white"><span class="relative text-white dark:text-black z-10">Community Hub</span></span><br /> 
            for your 
            <span class="relative inline-block px-2 md:px-4 before:content-[''] before:absolute before:-inset-0.5 md:before:-inset-1 before:-skew-x-6 before:bg-black before:text-white dark:before:bg-white"><span class="relative text-white dark:text-black z-10">Climbing Gym</span></span>
        </h1>
    </div>

    <div class="h-16 flex items-center justify-center pointer-events-auto">
        <p class="text-xl md:text-3xl font-mono text-zinc-600 dark:text-zinc-300">
            Slate Social is <span id="glitch-text" class="text-black dark:text-white font-bold border-b-2 border-zinc-900 dark:border-zinc-100 pb-1">loading...</span>
        </p>
    </div>

    <div class="flex flex-col sm:flex-row gap-6 justify-center pt-8 pointer-events-auto">
      <a href="#about" class="group relative min-w-[200px] px-8 py-4 bg-zinc-900 text-white dark:bg-white dark:text-black font-bold overflow-hidden transition-all hover:scale-105 active:scale-95 text-sm uppercase tracking-wider inline-flex items-center justify-center">
        <span class="relative z-10 transition-transform duration-300 group-hover:-translate-x-2">Learn More</span>
        <div class="absolute right-8 opacity-0 translate-x-4 transition-all duration-300 group-hover:opacity-100 group-hover:translate-x-0 z-10">
            <ArrowDown class="w-5 h-5" />
        </div>
        <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
      </a>
    </div>
  </div>
</section>

<style>
    @keyframes blob {
      0% { transform: translate(0px, 0px) scale(1); }
      33% { transform: translate(30px, -50px) scale(1.1); }
      66% { transform: translate(-20px, 20px) scale(0.9); }
      100% { transform: translate(0px, 0px) scale(1); }
    }
    .animate-blob {
      animation: blob 7s infinite;
    }
    .animation-delay-2000 {
      animation-delay: 2s;
    }
    .animation-delay-4000 {
      animation-delay: 4s;
    }
    .animation-delay-6000 {
      animation-delay: 6s;
    }
</style>

<script>
    // --- Fluid Dot Grid Animation ---
    const canvas = document.getElementById('dot-canvas') as HTMLCanvasElement;
    if (canvas) {
        const ctx = canvas.getContext('2d');
        let width = 0;
        let height = 0;
        let dots: { baseX: number; baseY: number; x: number; y: number; phase: number; speed: number }[] = [];
        const gap = 12; // "Very tight" grid
        let time = 0;

        const resize = () => {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            
            // Re-initialize dots
            dots = [];
            const cols = Math.ceil(width / gap);
            const rows = Math.ceil(height / gap);
            
            for (let i = 0; i < cols; i++) {
                for (let j = 0; j < rows; j++) {
                    // Add random spawn offset
                    const offsetX = (Math.random() - 0.5) * (gap * 0.7);
                    const offsetY = (Math.random() - 0.5) * (gap * 0.7);
                    
                    dots.push({
                        baseX: i * gap + offsetX,
                        baseY: j * gap + offsetY,
                        x: i * gap + offsetX,
                        y: j * gap + offsetY,
                        // Random phase vertical/horizontal
                        phase: Math.random() * Math.PI * 2,
                        speed: 0.5 + Math.random() * 0.5,
                    });
                }
            }
        };

        const animate = () => {
            if (!ctx) return;
            
            // Clear
            ctx.clearRect(0, 0, width, height);

            // Check dark mode for color
            const isDark = document.documentElement.classList.contains('dark');
            ctx.fillStyle = isDark ? 'rgba(255, 255, 255, 0.3)' : 'rgba(0, 0, 0, 0.2)';

            time += 0.01;

            dots.forEach(dot => {
                // Wave motion calculation
                // Combine large waves with small jitter
                const waveX = Math.sin(time * dot.speed + dot.baseY * 0.005) * 3;
                const waveY = Math.cos(time * dot.speed + dot.baseX * 0.005) * 3;
                
                // Add a second layer of interference
                const noise = Math.sin(time * 2 + dot.phase) * 1.5;

                dot.x = dot.baseX + waveX + noise;
                dot.y = dot.baseY + waveY + noise;

                ctx.beginPath();
                ctx.arc(dot.x, dot.y, 0.7, 0, Math.PI * 2);
                ctx.fill();
            });

            requestAnimationFrame(animate);
        };

        window.addEventListener('resize', resize);
        resize();
        animate();
    }


    // --- Existing Glitch Text Logic ---
    const phrases = [
        "community groups",
        "gym competitions",
        "club management",
        "member polls",
        "beta sharing",
        "partner finding",
        "your community hub"
    ];
    
    
    const el = document.getElementById('glitch-text');

    const chars = '!<>-_\\/[]{}â€”=+*^?#________';
    
    let counter = 0;
    
    const nextPhrase = () => {
        counter = (counter + 1) % phrases.length;
        return phrases[counter];
    };
    
    const scramble = async (element: HTMLElement, newText: string) => {
        const oldText = element.innerText;
        const length = Math.max(oldText.length, newText.length);
        const promise = new Promise<void>((resolve) => {
            let frame = 0;
            const queue: { from: string, to: string, start: number, end: number }[] = [];
            
            for (let i = 0; i < length; i++) {
                const from = oldText[i] || '';
                const to = newText[i] || '';
                const start = Math.floor(Math.random() * 15);
                const end = start + Math.floor(Math.random() * 15);
                queue.push({ from, to, start, end });
            }
            
            const update = () => {
               let output = '';
               let complete = 0;
               
               for (let i = 0; i < length; i++) {
                   const { from, to, start, end } = queue[i];
                   let char = from;
                   
                   if (frame >= end) {
                       char = to;
                       complete++;
                   } else if (frame >= start) {
                       char = chars[Math.floor(Math.random() * chars.length)];
                   }
                   
                   output += char;
               }
               
               element.innerText = output;
               
               if (complete === length) {
                   resolve();
               } else {
                   frame++;
                   requestAnimationFrame(update);
               }
            };
            
            update();
        });
        return promise;
    };
    
    const loop = async () => {
        while(true) {
            await new Promise(r => setTimeout(r, 3000)); // Wait before changing
            if (el) {
                await scramble(el, nextPhrase());
            }
        }
    };
    
    // Start loop
    if (el) {
        el.innerText = phrases[0];
        loop();
    }
</script>

<style>
    @keyframes float-0 {
        0%, 100% { transform: translate(0, 0) scale(1); }
        25% { transform: translate(30px, -50px) scale(1.1); }
        50% { transform: translate(-20px, -100px) scale(0.9); }
        75% { transform: translate(-40px, -30px) scale(1.05); }
    }
    @keyframes float-1 {
        0%, 100% { transform: translate(0, 0) scale(1); }
        25% { transform: translate(-50px, 30px) scale(0.95); }
        50% { transform: translate(40px, 60px) scale(1.1); }
        75% { transform: translate(20px, -40px) scale(1); }
    }
    @keyframes float-2 {
        0%, 100% { transform: translate(0, 0) scale(1); }
        25% { transform: translate(60px, 40px) scale(1.05); }
        50% { transform: translate(-30px, -30px) scale(0.9); }
        75% { transform: translate(-60px, 50px) scale(1.1); }
    }
    .animate-float-0 {
        animation: float-0 ease-in-out infinite;
    }
    .animate-float-1 {
        animation: float-1 ease-in-out infinite;
    }
    .animate-float-2 {
        animation: float-2 ease-in-out infinite;
    }
</style>
